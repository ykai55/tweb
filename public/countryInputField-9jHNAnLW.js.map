{"version":3,"file":"countryInputField-9jHNAnLW.js","sources":["../src/helpers/formatPhoneNumber.ts","../src/components/telInputField.ts","../src/components/countryInputField.ts"],"sourcesContent":["/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {HelpCountry, HelpCountryCode} from '../layer';\nimport I18n from '../lib/langPack';\n\nlet sortedCountries: HelpCountry[];\ntype PrefixCountry = {country: HelpCountry, code: HelpCountryCode};\nconst prefixes: Map<string, PrefixCountry> = new Map();\nlet maxPrefixLength = 0;\nconst setPrefix = (country: HelpCountry, code: HelpCountryCode, prefix: string = '') => {\n  prefix = code.country_code + prefix;\n  /* if(prefixes.has(prefix)) {\n    console.error('asdasdasd', prefixes.get(prefix), country, code);\n  } */\n  maxPrefixLength = Math.max(maxPrefixLength, prefix.length);\n  prefixes.set(prefix, {country, code});\n};\n\nexport function formatPhoneNumber(originalStr: string): {\n  formatted: string,\n  country: HelpCountry,\n  code: HelpCountryCode,\n  leftPattern: string\n} {\n  originalStr = originalStr || '';\n\n  if(!prefixes.size) {\n    I18n.countriesList.forEach((country) => {\n      country.country_codes.forEach((code) => {\n        if(code.prefixes) {\n          code.prefixes.forEach((prefix) => {\n            setPrefix(country, code, prefix);\n          });\n        } else {\n          setPrefix(country, code);\n        }\n      });\n    });\n  }\n\n  // return {formatted: originalStr, country: undefined as any, leftPattern: ''};\n  let str = originalStr.replace(/\\D/g, '');\n  const phoneCode = str.slice(0, maxPrefixLength);\n\n  // //console.log('str', str, phoneCode);\n  // if(!sortedCountries) {\n  //   sortedCountries = I18n.countriesList.slice().sort((a, b) => b.country_codes[0].country_code.length - a.country_codes[0].country_code.length);\n  // }\n\n  // let country = sortedCountries.find((c) => {\n  //   return c.country_codes.find((c) => phoneCode.indexOf(c.replace(/\\D/g, '')) === 0);\n  // });\n\n  let prefixCountry: PrefixCountry;\n  for(let i = phoneCode.length - 1; i >= 0; --i) { // lookup for country by prefix\n    prefixCountry = prefixes.get(phoneCode.slice(0, i + 1));\n    if(prefixCountry) {\n      break;\n    }\n  }\n\n  if(!prefixCountry) {\n    return {\n      formatted: str,\n      country: undefined,\n      code: undefined,\n      leftPattern: ''\n    };\n  }\n\n  // country = /* PhoneCodesMain[country.phoneCode] ||  */country;\n  const country = prefixCountry.country;\n\n  const patterns = prefixCountry.code.patterns || [];\n  const searchForPattern = str.slice(prefixCountry.code.country_code.length); // splice country code\n  let pattern = '', mostMatchedPatternMatches = 0, mostMatchedPattern = '';\n  for(let i = patterns.length - 1; i >= 0; --i) {\n    pattern = patterns[i];\n\n    const _pattern = pattern.replace(/ /g, '');\n    let patternMatches = 0;\n    for(let k = 0, length = Math.min(searchForPattern.length, _pattern.length); k < length; ++k) {\n      if(searchForPattern[k] === _pattern[k]) {\n        patternMatches += 1.01;\n      } else if(_pattern[k] === 'X') {\n        ++patternMatches;\n      } else {\n        patternMatches = 0;\n        break;\n      }\n    }\n\n    if(patternMatches > mostMatchedPatternMatches) {\n      mostMatchedPatternMatches = patternMatches;\n      mostMatchedPattern = pattern;\n    }\n  }\n\n  pattern = mostMatchedPattern || pattern;\n  pattern = pattern.replace(/\\d/g, 'X');\n\n  pattern = prefixCountry.code.country_code + ' ' + pattern;\n  // let pattern = country.pattern || country.phoneCode;\n  pattern.split('').forEach((symbol, idx) => {\n    if(symbol === ' ' && str[idx] !== ' ' && str.length > idx) {\n      str = str.slice(0, idx) + ' ' + str.slice(idx);\n    }\n  });\n\n  /* if(country.pattern) {\n    str = str.slice(0, country.pattern.length);\n  } */\n\n  let leftPattern = pattern && pattern.length > str.length ? pattern.slice(str.length) : '';\n  if(leftPattern) {\n    /* const length = str.length;\n    leftPattern = leftPattern.split('').map((_, idx) => (length + idx).toString().slice(-1)).join(''); */\n    leftPattern = leftPattern.replace(/X/g, '‒');\n    // leftPattern = leftPattern.replace(/X/g, '0');\n  }\n\n  return {formatted: str, country, code: prefixCountry.code, leftPattern};\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport placeCaretAtEnd from '../helpers/dom/placeCaretAtEnd';\nimport {formatPhoneNumber} from '../helpers/formatPhoneNumber';\nimport {IS_APPLE, IS_ANDROID, IS_APPLE_MOBILE} from '../environment/userAgent';\nimport {HelpCountry, HelpCountryCode} from '../layer';\nimport InputField, {InputFieldOptions} from './inputField';\n\nexport default class TelInputField extends InputField {\n  private pasted = false;\n  public lastValue = '';\n\n  constructor(options: InputFieldOptions & {\n    onInput?: (formatted: ReturnType<typeof formatPhoneNumber>) => void\n  } = {}) {\n    super({\n      label: 'Contacts.PhoneNumber.Placeholder',\n      // plainText: true,\n      name: 'phone',\n      ...options\n    });\n\n    this.container.classList.add('input-field-phone');\n\n    const telEl = this.input;\n    if(telEl instanceof HTMLInputElement) {\n      telEl.type = 'tel';\n      telEl.autocomplete = 'rr55RandomRR55' as any;\n    } else {\n      telEl.inputMode = 'decimal';\n\n      const pixelRatio = window.devicePixelRatio;\n      if(pixelRatio > 1) {\n        let letterSpacing: number;\n        if(IS_APPLE) {\n          letterSpacing = pixelRatio * -.16;\n        } else if(IS_ANDROID) {\n          letterSpacing = 0;\n        }\n\n        telEl.style.setProperty('--letter-spacing', letterSpacing + 'px');\n      }\n\n      const originalFunc = this.setValueSilently.bind(this);\n      this.setValueSilently = (value) => {\n        originalFunc(value);\n        placeCaretAtEnd(this.input, true);\n      };\n    }\n\n    telEl.addEventListener('input', () => {\n      // console.log('input', this.value);\n      telEl.classList.remove('error');\n\n      const value = this.value;\n      const diff = Math.abs(value.length - this.lastValue.length);\n      if(diff > 1 && !this.pasted && IS_APPLE_MOBILE) {\n        this.setValueSilently(this.lastValue + value);\n      }\n\n      this.pasted = false;\n\n      this.setLabel();\n\n      let formattedPhoneNumber: ReturnType<typeof formatPhoneNumber>;\n      let formatted: string, country: HelpCountry, countryCode: HelpCountryCode, leftPattern = '';\n      if(this.value.replace(/\\++/, '+') === '+') {\n        this.setValueSilently('+');\n      } else {\n        formattedPhoneNumber = formatPhoneNumber(this.value);\n        formatted = formattedPhoneNumber.formatted;\n        country = formattedPhoneNumber.country;\n        leftPattern = formattedPhoneNumber.leftPattern;\n        countryCode = formattedPhoneNumber.code;\n        this.setValueSilently(this.lastValue = formatted ? '+' + formatted : '');\n      }\n\n      telEl.dataset.leftPattern = leftPattern/* .replace(/X/g, '0') */;\n\n      // console.log(formatted, country);\n\n      options.onInput && options.onInput(formattedPhoneNumber);\n    });\n\n    telEl.addEventListener('paste', () => {\n      this.pasted = true;\n      // console.log('paste', telEl.value);\n    });\n\n    /* telEl.addEventListener('change', (e) => {\n      console.log('change', telEl.value);\n    }); */\n\n    telEl.addEventListener('keypress', (e) => {\n      // console.log('keypress', this.value);\n      const key = e.key;\n      if(/\\D/.test(key) && !(e.metaKey || e.ctrlKey) && key !== 'Backspace' && !(key === '+' && e.shiftKey/*  && !this.value */)) {\n        e.preventDefault();\n        return false;\n      }\n    });\n\n    /* telEl.addEventListener('focus', function(this: typeof telEl, e) {\n      this.removeAttribute('readonly'); // fix autocomplete\n    });*/\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_EMOJI_SUPPORTED from '../environment/emojiSupport';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport findUpTag from '../helpers/dom/findUpTag';\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\nimport fastSmoothScroll from '../helpers/fastSmoothScroll';\nimport {randomLong} from '../helpers/random';\nimport {HelpCountry, HelpCountryCode} from '../layer';\nimport I18n, {i18n} from '../lib/langPack';\nimport wrapEmojiText from '../lib/richTextProcessor/wrapEmojiText';\nimport rootScope from '../lib/rootScope';\nimport {getCountryEmoji} from '../vendor/emoji';\nimport InputField, {InputFieldOptions} from './inputField';\nimport Scrollable from './scrollable';\n\nlet countries: HelpCountry.helpCountry[];\nconst setCountries = () => {\n  countries = I18n.countriesList\n  .filter((country) => !country.pFlags?.hidden)\n  .sort((a, b) => (a.name || a.default_name).localeCompare(b.name || b.default_name));\n};\n\nlet init = () => {\n  init = undefined;\n  setCountries();\n  rootScope.addEventListener('language_apply', () => {\n    setCountries();\n  });\n};\n\nconst VIRTUAL_COUNTRIES = new Set(['FT']);\n\nexport function filterCountries(value: string, excludeVirtual?: boolean) {\n  init?.();\n\n  value = value.toLowerCase();\n  const filtered = countries.filter((c) => {\n    if(excludeVirtual && VIRTUAL_COUNTRIES.has(c.iso2)) {\n      return false;\n    }\n\n    const names = [\n      c.name,\n      c.default_name,\n      c.iso2\n    ];\n\n    names.filter(Boolean).forEach((name) => {\n      const abbr = name.split(' ').filter((word) => /\\w/.test(word)).map((word) => word[0]).join('');\n      if(abbr.length > 1) {\n        names.push(abbr);\n      }\n    });\n\n    const good = !!names.filter(Boolean).find((str) => str.toLowerCase().indexOf(value) !== -1)/*  === 0 */;// i.test(c.name);\n    return good;\n  });\n\n  return filtered;\n}\n\nexport function sortCountries(countries: HelpCountry.helpCountry[]) {\n  return countries.sort((a, b) => (a.name || a.default_name).localeCompare(b.name || b.default_name));\n}\n\nexport default class CountryInputField extends InputField {\n  private lastCountrySelected: HelpCountry;\n  private lastCountryCodeSelected: HelpCountryCode;\n\n  private hideTimeout: number;\n  private selectWrapper: HTMLElement;\n\n  private liMap: Map<string, HTMLLIElement[]>;\n\n  constructor(public options: InputFieldOptions & {\n    onCountryChange?: (country: HelpCountry.helpCountry, code: HelpCountryCode.helpCountryCode) => void,\n    noPhoneCodes?: boolean\n  } = {}) {\n    super({\n      label: 'Country',\n      name: randomLong(),\n      ...options\n    });\n\n    init?.();\n\n    this.liMap = new Map();\n\n    this.container.classList.add('input-select');\n\n    const selectWrapper = this.selectWrapper = document.createElement('div');\n    selectWrapper.classList.add('select-wrapper', 'z-depth-3', 'hide');\n\n    const arrowDown = document.createElement('span');\n    arrowDown.classList.add('arrow', 'arrow-down');\n    this.container.append(arrowDown);\n\n    const selectList = document.createElement('ul');\n    selectWrapper.appendChild(selectList);\n\n    const scroll = new Scrollable(selectWrapper);\n\n    let initSelect = () => {\n      initSelect = null;\n\n      countries.forEach((c) => {\n        if(options.noPhoneCodes && VIRTUAL_COUNTRIES.has(c.iso2)) {\n          return;\n        }\n\n        const emoji = getCountryEmoji(c.iso2);\n\n        const liArr: Array<HTMLLIElement> = [];\n        for(let i = 0, length = Math.min(c.country_codes.length, options.noPhoneCodes ? 1 : Infinity); i < length; ++i) {\n          const countryCode = c.country_codes[i];\n          const li = document.createElement('li');\n\n          const wrapped = wrapEmojiText(emoji);\n          if(IS_EMOJI_SUPPORTED) {\n            const spanEmoji = document.createElement('span');\n            setInnerHTML(spanEmoji, wrapped);\n            li.append(spanEmoji);\n          } else {\n            setInnerHTML(li, wrapped);\n          }\n\n          const el = i18n(c.default_name as any);\n          el.dataset.defaultName = c.default_name;\n          li.append(el);\n\n          if(!options.noPhoneCodes) {\n            const span = document.createElement('span');\n            span.classList.add('phone-code');\n            span.innerText = '+' + countryCode.country_code;\n            li.appendChild(span);\n          }\n\n          liArr.push(li);\n          selectList.append(li);\n        }\n\n        this.liMap.set(c.iso2, liArr);\n      });\n\n      selectList.addEventListener('mousedown', (e) => {\n        if(e.button !== 0) { // other buttons but left shall not pass\n          return;\n        }\n\n        const target = findUpTag(e.target, 'LI')\n        this.selectCountryByTarget(target);\n        // console.log('clicked', e, countryName, phoneCode);\n      });\n\n      this.container.appendChild(selectWrapper);\n    };\n\n    initSelect();\n\n    this.input.addEventListener('focus', (e) => {\n      if(initSelect) {\n        initSelect();\n      } else {\n        countries.forEach((c) => {\n          const arr = this.liMap.get(c.iso2);\n          if(!arr) return;\n          arr.forEach((li) => li.style.display = '');\n        });\n      }\n\n      clearTimeout(this.hideTimeout);\n      this.hideTimeout = undefined;\n\n      selectWrapper.classList.remove('hide');\n      void selectWrapper.offsetWidth; // reflow\n      selectWrapper.classList.add('active');\n\n      this.select();\n\n      fastSmoothScroll({\n        // container: page.pageEl.parentElement.parentElement,\n        container: findUpClassName(this.container, 'scrollable-y'),\n        element: this.input,\n        position: 'start',\n        margin: 4\n      });\n\n      setTimeout(() => {\n        if(!mouseDownHandlerAttached) {\n          document.addEventListener('mousedown', onMouseDown, {capture: true});\n          mouseDownHandlerAttached = true;\n        }\n      }, 0);\n    });\n\n    let mouseDownHandlerAttached = false;\n    const onMouseDown = (e: MouseEvent) => {\n      if(findUpClassName(e.target, 'input-select')) {\n        return;\n      }\n      if(e.target === this.input) {\n        return;\n      }\n\n      this.hidePicker();\n      document.removeEventListener('mousedown', onMouseDown, {capture: true});\n      mouseDownHandlerAttached = false;\n    };\n\n    /* false && this.input.addEventListener('blur', function(this: typeof this.input, e) {\n      hidePicker();\n\n      e.cancelBubble = true;\n    }, {capture: true}); */\n\n    const onKeyPress = (e: KeyboardEvent) => {\n      const key = e.key;\n      if(e.ctrlKey || key === 'Control') return false;\n\n      // let i = new RegExp('^' + this.value, 'i');\n      const filtered = new Set(filterCountries(this.value).map((c) => c.iso2));\n      this.liMap.forEach((arr, iso2) => {\n        arr.forEach((li) => li.style.display = filtered.has(iso2) ? '' : 'none');\n      });\n\n      // Код ниже автоматически выберет страну если она осталась одна при поиске\n      /* if(matches.length === 1 && matches[0].li.length === 1) {\n        if(matches[0].name === lastCountrySelected) return false;\n        //console.log('clicking', matches[0]);\n\n        var clickEvent = document.createEvent('MouseEvents');\n        clickEvent.initEvent('mousedown', true, true);\n        matches[0].li[0].dispatchEvent(clickEvent);\n        return false;\n      } else  */if(!filtered.size) {\n        countries.forEach((c) => {\n          const arr = this.liMap.get(c.iso2);\n          if(!arr) {\n            return;\n          }\n\n          arr.forEach((li) => li.style.display = '');\n        });\n      } else if(filtered.size === 1 && key === 'Enter') {\n        cancelEvent(e);\n        this.selectCountryByTarget(this.liMap.get([...filtered][0])[0]);\n      }\n    };\n\n    this.input.addEventListener('keyup', onKeyPress);\n    this.input.addEventListener('keydown', (e) => {\n      if(e.key === 'Enter') {\n        onKeyPress(e);\n      }\n    });\n\n    arrowDown.addEventListener('mousedown', (e) => {\n      if(this.input.matches(':focus')) {\n        this.hidePicker();\n        this.input.blur();\n      } else {\n        e.cancelBubble = true;\n        e.preventDefault();\n        this.input.focus();\n      }\n    });\n  }\n\n  public getSelected() {\n    return {country: this.lastCountrySelected, code: this.lastCountryCodeSelected};\n  }\n\n  public hidePicker = () => {\n    if(this.hideTimeout !== undefined) return;\n    this.selectWrapper.classList.remove('active');\n    this.hideTimeout = window.setTimeout(() => {\n      this.selectWrapper.classList.add('hide');\n      this.hideTimeout = undefined;\n    }, 200);\n  }\n\n  public selectCountryByTarget = (target: HTMLElement) => {\n    const defaultName = target.querySelector<HTMLElement>('[data-default-name]').dataset.defaultName;\n    const phoneCodeEl = target.querySelector<HTMLElement>('.phone-code');\n    const phoneCode = phoneCodeEl?.innerText;\n    const countryCode = phoneCode && phoneCode.replace(/\\D/g, '');\n\n    this.value = i18n(defaultName as any);\n    this.lastCountrySelected = countries.find((c) => c.default_name === defaultName);\n    this.lastCountryCodeSelected = countryCode && this.lastCountrySelected.country_codes.find((_countryCode) => _countryCode.country_code === countryCode);\n\n    this.options.onCountryChange?.(this.lastCountrySelected, this.lastCountryCodeSelected);\n    this.hidePicker();\n  }\n\n  public selectCountryByIso2(iso2: string) {\n    this.selectCountryByTarget(this.liMap.get(iso2)[0]);\n  }\n\n  public override(country: HelpCountry, code: HelpCountryCode, countryName?: string) {\n    this.setValueSilently(country ? i18n(country.default_name as any) : countryName);\n    this.lastCountrySelected = country;\n    this.lastCountryCodeSelected = code;\n    this.options.onCountryChange?.(this.lastCountrySelected, this.lastCountryCodeSelected);\n  }\n}\n"],"names":["prefixes","maxPrefixLength","setPrefix","country","code","prefix","formatPhoneNumber","originalStr","I18n","str","phoneCode","prefixCountry","patterns","searchForPattern","pattern","mostMatchedPatternMatches","mostMatchedPattern","_pattern","patternMatches","k","length","symbol","idx","leftPattern","TelInputField","InputField","options","telEl","pixelRatio","letterSpacing","IS_APPLE","IS_ANDROID","originalFunc","value","placeCaretAtEnd","IS_APPLE_MOBILE","formattedPhoneNumber","formatted","e","key","countries","setCountries","a","b","init","rootScope","VIRTUAL_COUNTRIES","filterCountries","excludeVirtual","c","names","name","abbr","word","CountryInputField","randomLong","target","defaultName","countryCode","i18n","_countryCode","selectWrapper","arrowDown","selectList","Scrollable","initSelect","emoji","getCountryEmoji","liArr","i","li","wrapped","wrapEmojiText","IS_EMOJI_SUPPORTED","spanEmoji","setInnerHTML","el","span","findUpTag","arr","fastSmoothScroll","findUpClassName","mouseDownHandlerAttached","onMouseDown","onKeyPress","filtered","iso2","cancelEvent","countryName"],"mappings":"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"}
const __vite__fileDeps=["./pageSignIn-bbLv_L9F.js","./index-DZ3NJB4a.js","./index-Dst2gk7F.css","./putPreloader-CM10eNov.js","./page-DkE3OdTH.js","./countryInputField-9jHNAnLW.js","./textToSvgURL-Cnw_Q8Rw.js","./qr-code-styling-CvBVNv73.js","./_commonjsHelpers-Cpj98o6Y.js","./pageIm-DkoYNddh.js","./pagePassword-DltqASNi.js","./loginPage-CRJ_W-i1.js","./htmlToSpan-DhAls8qz.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{z as d,B as R,l as V,d as c,k as $,x as z,v as F,q as H,h as N,_ as E,C as j,A as P,D as T}from"./index-DZ3NJB4a.js";import{P as W}from"./page-DkE3OdTH.js";import{p as O}from"./putPreloader-CM10eNov.js";import{b as G,t as J}from"./textToSvgURL-Cnw_Q8Rw.js";let b=!1;function K(){return C||(C=c.managers.apiManager.getConfig().then(e=>e.suggested_lang_code!==d.lastRequestedLangCode?Promise.all([e,d.getStrings(e.suggested_lang_code,["Login.ContinueOnLanguage"]),d.getCacheLangPackAndApply()]):[]))}let C;function U(e){b||K().then(([t,u])=>{if(!t)return;const s=[];u.forEach(i=>{const m=d.strings.get(i.key);m&&(s.push(m),d.strings.set(i.key,i))});const o="Login.ContinueOnLanguage",a=R("btn-primary btn-secondary btn-primary-transparent primary",{text:o});a.lastElementChild.classList.remove("i18n"),V({text:[d.format(o,!0)]}).then(()=>{window.requestAnimationFrame(()=>{e.append(a)})}),c.addEventListener("language_apply",()=>{a.remove()},{once:!0}),s.forEach(i=>{d.strings.set(i.key,i)}),$(a,i=>{z(i),b=!0,a.disabled=!0,O(a),d.getLangPackAndApply(t.suggested_lang_code)})})}function X(e,t){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")}function Y(e){let t,u="";for(let s=e.length,o=0,a=0;a<s;++a)t=a%3,o|=e[a]<<(16>>>t&24),(t===2||s-a===1)&&(u+=String.fromCharCode(L(o>>>18&63),L(o>>>12&63),L(o>>>6&63),L(o&63)),o=0);return u.replace(/A(?=A$|$)/g,"=")}function L(e){return e<26?e+65:e<52?e+71:e<62?e-4:e===62?43:e===63?47:65}const A=3,Z=async()=>{const t=x.pageEl.querySelector(".auth-image");let u=O(t,!0);const s=document.createElement("div");s.classList.add("input-wrapper");const o=R("btn-primary btn-secondary btn-primary-transparent primary",{text:"Login.QR.Cancel"});s.append(o),F()===1&&U(s);const a=t.parentElement,i=document.createElement("h4");H(i,"Login.QR.Title");const m=document.createElement("ol");m.classList.add("qr-description"),["Login.QR.Help1","Login.QR.Help2","Login.QR.Help3"].forEach(l=>{const p=document.createElement("li");p.append(N(l)),m.append(p)}),a.append(i,m,s),o.addEventListener("click",()=>{E(()=>import("./pageSignIn-bbLv_L9F.js"),__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url).then(l=>l.default.mount()),f=!0});const I=(await Promise.all([E(()=>import("./qr-code-styling-CvBVNv73.js").then(l=>l.q),__vite__mapDeps([7,8]),import.meta.url)]))[0].default;let f=!1;c.addEventListener("user_auth",l=>{f=!0,_=null},{once:!0});const k={ignoreErrors:!0};let w;const q=async l=>{try{const p=await j.getUserIds();let n=await c.managers.apiManager.invokeApi("auth.exportLoginToken",{api_id:P.id,api_hash:P.hash,except_ids:p.map(g=>g.toUserId())},{ignoreErrors:!0});if(n._==="auth.loginTokenMigrateTo"&&(k.dcId||(k.dcId=n.dc_id,c.managers.apiManager.setBaseDcId(n.dc_id)),n=await c.managers.apiManager.invokeApi("auth.importLoginToken",{token:n.token},k)),n._==="auth.loginTokenSuccess"){const g=n.authorization;return await c.managers.apiManager.setUser(g.user),E(()=>import("./pageIm-DkoYNddh.js"),__vite__mapDeps([9,1,2,4]),import.meta.url).then(h=>h.default.mount()),!0}if(!w||!G(w,n.token)){w=n.token;const g=Y(n.token),h="tg://login?token="+X(g,!0),v=window.getComputedStyle(document.documentElement),D=v.getPropertyValue("--surface-color").trim(),B=v.getPropertyValue("--primary-text-color").trim(),M=v.getPropertyValue("--primary-color").trim(),Q=await fetch("assets/img/logo_padded.svg").then(r=>r.text()).then(r=>(r=r.replace(/(fill:).+?(;)/,`$1${M}$2`),J(r))),y=new I({width:240*window.devicePixelRatio,height:240*window.devicePixelRatio,data:h,image:Q,dotsOptions:{color:B,type:"rounded"},cornersSquareOptions:{type:"extra-rounded"},imageOptions:{imageSize:1,margin:0},backgroundOptions:{color:D},qrOptions:{errorCorrectionLevel:"L"}});y.append(t),t.lastChild.classList.add("qr-canvas");let S;y._drawingPromise?S=y._drawingPromise:S=Promise.race([T(1e3),new Promise(r=>{y._canvas._image.addEventListener("load",()=>{window.requestAnimationFrame(()=>r())},{once:!0})})]),await S.then(()=>{if(u){u.style.animation="hide-icon .4s forwards";const r=t.children[1];r.style.display="none",r.style.animation="grow-icon .4s forwards",setTimeout(()=>{r.style.display=""},150),setTimeout(()=>{r.style.animation=""},500),u=void 0}else Array.from(t.children).slice(0,-1).forEach(r=>{r.remove()})})}if(l){const g=Date.now()/1e3,h=n.expires-g-await c.managers.timeManager.getServerTimeOffset();await T(h>A?1e3*A:1e3*h|0)}}catch(p){switch(p.type){case"SESSION_PASSWORD_NEEDED":E(()=>import("./pagePassword-DltqASNi.js"),__vite__mapDeps([10,1,2,3,4,11,12]),import.meta.url).then(n=>n.default.mount()),f=!0,_=null;break;default:console.error("pageSignQR: default error:",p),f=!0;break}return!0}return!1};return async()=>{f=!1;do if(f||await q(!0))break;while(!0)}};let _;const x=new W("page-signQR",!0,()=>_,()=>{_||(_=Z()),_.then(e=>{e()}),c.managers.appStateManager.pushToState("authState",{_:"authStateSignQr"})}),oe=Object.freeze(Object.defineProperty({__proto__:null,default:x},Symbol.toStringTag,{value:"Module"}));export{oe as a,U as g,x as p};
//# sourceMappingURL=pageSignQR-CrXOH0a0.js.map
